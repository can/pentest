# -*- coding: utf-8 -*-
# build an Excel file
# Url, Type, Severity, Certainty, Confirmed
import os
from xml.dom import minidom
corrupted = open('corrupted','w')
cvsfile=open('vulns.csv','w')
for filename in os.listdir(os.getcwd()):
	if filename.endswith('.xml'):
		try:
			xmldb = minidom.parse(filename)	
			target = xmldb.getElementsByTagName('target')[0]
			date = target.getElementsByTagName('scantime')[0].firstChild.data
			vulns = xmldb.getElementsByTagName('vulnerability')
			for v in vulns:
				url = v.getElementsByTagName('url')[0].firstChild.data
				vtype = v.getElementsByTagName('type')[0].firstChild.data
				severity = v.getElementsByTagName('severity')[0].firstChild.data
				certainty = v.getElementsByTagName('certainty')[0].firstChild.data
				vulnerableparametertype = v.getElementsByTagName('vulnerableparametertype')[0].firstChild.data
				vulnerableparameter = v.getElementsByTagName('vulnerableparameter')[0].firstChild.data
				vulnerableparametervalue = v.getElementsByTagName('vulnerableparametervalue')[0].firstChild.data
				confirmed = v.attributes['confirmed'].value
				cvsfile.write(str(url)+"|"+str(vtype)+"|"+str(severity)+"|"+str(certainty)+"|"+str(vulnerableparametertype)+"|"+str(vulnerableparameter)+"|"+str(vulnerableparametervalue)+"|"+str(confirmed)+"\n")
				print str(url)+"|"+str(vtype)+"|"+str(severity)+"|"+str(certainty)+"|"+str(vulnerableparametertype)+"|"+str(vulnerableparameter)+"|"+str(vulnerableparametervalue)+"|"+str(confirmed)
		
		except:	
			print corrupted
			corrupted.write(filename+"\n")
			
#cvsfile.close()
#corrupted.close() 
